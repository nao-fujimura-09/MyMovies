<div class="container">
  <h2 class="text-center my-5">作品詳細</h2>
<h2 class="text-center font-weight-bold mb-3"><%= @movie.title %></h2>
  <div class="row">
    <%= render 'list', movies: @movies %> <!--ユーザー詳細呼び出し-->
    
    <!--映画詳細  -->
    <div class="col-3">
      <%= image_tag "https://image.tmdb.org/t/p/w154/#{@movie.poster_path}", class:"mx-5 mt-5" %>
    </div>
       
    <div class="col-6">
      <table class="table-borderless mt-5">
        <tbody>
          <tr>
            <td>
              <h4 class="font-weight-bold">あらすじ</h4><br>
              <%= @movie.overview %>
              <h4 class="font-weight-bold mt-3">出演者</h4><br>
              <% @persons.each do |person|%>/
                <%= person %>
              <% end %>
              
            </td>
          </tr>
        </tbody>
      </table>
        
      <div class=" d-flex align-items-end justify-content-between my-5">
        <h3 class="font-weight-bold">閲覧数：</h3>
          
        <h3 class="font-weight-bold">平均評価：</h3>
        <div><h3><%= Review.where(movie_id: @movie.id).average(:star) %>点</h3></div>
          
          <div id="star_<%= @review.movie_id.to_s %>"></div>
            <script>
              $('#star_<%= @review.movie_id %>').empty();
              $('#star_<%= @review.movie_id %>').raty({
                size: 70,
                starOn : '<%= asset_path('star-on.png') %>',
                starOff: "<%= asset_path('star-off.png') %>",
                starHalf: "<%= asset_path('star-half.png') %>",
                scoreName: "review[star]", //reviewモデルのstarカラムに保存
                half: true, 
                readOnly: true,
                score: <%= @review.star %>
                });
            </script>
      </div>
    </div>
  </div>
    <!--レビュー-->
  <div class="row">
   <div class="col-2"></div>
    <div class="col-10 mt-5">
      <%= form_with model: @review, url: public_reviews_path do |f| %>
      <%= f.hidden_field :movie_id, :value => @movie.id %>
      
      <div class="border-bottom">
        <h2 font-weight-bold mt-5>レビューする</h2>
        
        <div class="form-inline justify-content-center">
          <div class="form-group" id="star_<%= @movie.id %>">
            <%= f.label :star,'評価 ', class:'col-form-label' %>
            <%= f.hidden_field :star, id: :review_star %>
          </div>
          <div id="star_<%= @movie.id %>"></div>
          <!--<div id="star_<%#= current_user.reviews.find_by(@review.id) %>"></div>-->
            
          <script>
            console.log("new")
            $('#star_<%= @movie.id %>').empty();
            $('#star_<%= @movie.id %>').raty({
              size: 80,
              starOn : '<%= asset_path('star-on.png') %>',
              starOff: "<%= asset_path('star-off.png') %>",
              starHalf: "<%= asset_path('star-half.png') %>",
              // score: <%#= @review.star %>,
              scoreName: "review[star]",
              half: true,
            });
          </script>
          </div>
        </div>
        <%= f.label :"タイトル" %>
        <%= f.text_field :title, class: 'form-control' %>
        <%= f.label :"本文" %>
        <%= f.text_field :body, class: 'form-control' %>
        
        <%= f.submit"レビューする", class:'button btn mt-4' %>
      <% end %>
      </div>

        
    <!--レビュー共通ページの呼び出し-->
    <%= render 'public/reviews/review_list', reviews: @reviews %>

  </div>
</div>
