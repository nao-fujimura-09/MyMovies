<div class="container">
  <h2 class="mt-5 text-center mb-5">作品一覧</h2>
  
  <!--映画一覧-->
  <ul class="d-flex flex-wrap row-gap">
    <% @movies.each do |movie| %>
      <li class="d-flex flex-column justify-content-between">
        <div class="mb-3"><%= image_tag "https://image.tmdb.org/t/p/w154/#{movie.poster_path}", class:"mx-5 mb-2" %></div>
        <div>
          <%= link_to public_movie_path(id: movie.id) do %>
            <h3 class="movies text-center"><%= movie.title.truncate(14) %></h3>
          <% end %>
        </div>
        
        <!--星評価-->
        <div class="text-center">
          <%= form_with model: @review, url: public_reviews_path, local: true do |f| %>
          <%= f.hidden_field :movie_id, :value => movie.id %>
            <div class="form-inline justify-content-center">
              <div class="form-group" id="star_<%= movie.id %>">
                <%= f.label :star,'評価 ', class:'col-form-label' %>
                <%= f.hidden_field :star, id: :review_star %>
              </div>
              <div id="star_<%= current_user.reviews.find_by(movie.id.to_s) %>"></div>
              <div class="form-group pl-3">
                <%= f.submit "評価"%>
              </div>
            </div>
              
            <script>
              $('#star_<%= movie.id %>').empty();
              $('#star_<%= movie.id %>').raty({
                size: 70,
                starOn : '<%= asset_path('star-on.png') %>',
                starOff: "<%= asset_path('star-off.png') %>",
                starHalf: "<%= asset_path('star-half.png') %>",
                scoreName: "review[star]",
                half: true,
              });
            </script>
          <% end %>

          <div class="form-inline justify-content-center mt-3 mb-5">
            <% if current_user.watch_lists.exists?(movie_id: movie.id) %>
              <!--ウォッチリストからの削除-->
              <div class="list">LIST
                <%= link_to public_watch_list_path(current_user.watch_lists.find_by(movie_id: movie.id)), method: :delete, class: 'btn btn-tag' do %>
                  <i class="fa fa-solid fa-minus fa-xs btn-tg", style="color:#f5f5f5;"></i>
                <% end %>
              </div>
            <% else %>
              <!--ウォッチリストへ追加-->
              <%= form_with model: @watch_list, url: public_watch_lists_path, method: :post do |f| %>
              <%= f.hidden_field :movie_id, :value => movie.id %>
                <div class="form-inline justify-content-center mt-3 mb-5">
                  <div class="list">LIST
                    <%= button_tag type: 'submit', class: "btn" do %>
                      <i class="fa fa-solid fa-plus fa-xs", style="color:#f5f5f5;"></i>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          
            <% if current_user.views.exists?(movie_id: movie.id) %>
                <div class="watch">VIEW
                  <%= link_to public_views_path(current_user.views.find_by(movie_id: movie.id)), method: :delete, class: 'btn btn-tag' do %>
                    <i class="fa fa-solid fa-eye fa-xs btn-tg", style="color:#black;"></i>
                  <% end %>
                </div>
            <% else %>
              <%= form_with model: @view, url: public_views_path, method: :post do |f| %>
              <%= f.hidden_field :movie_id, :value => movie.id %>
                <div class="form-inline justify-content-center mt-3 mb-5">
                  <div class="watch">VIEW
                    <%= button_tag type: 'submit', class: "btn" do %>
                      <i class="fa fa-solid fa-eye fa-xs", style="color:#f5f5f5;"></i>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      </li>
    <% end %>
  </ul>
</div>




<!--<style>-->
<!--  ul {list-style: none;}-->
<!--  h3 {font-size: 1.3em;font-weight: 700;}-->
<!--  .row-gap { row-gap: 20px; }-->
<!--</style>-->
